// Zoom to your geometries
function getCartoDBBBox(a,b){var c="select ST_Extent(the_geom) from "+cartodb_table_name;a!=null&&(c+=" where map_id="+a);var d=TILEHTTP+"://"+cartodb_user_name+"."+SQL_SERVER+global_api_url+"sql/?q="+escape(c);$.ajax({method:"GET",url:d,dataType:"jsonp",success:function(a){if(a.rows[0].st_extent!=null){var c=a.rows[0].st_extent.replace("BOX(","").replace(")","").split(","),d=c[0].split(" "),e=c[1].split(" "),f=new google.maps.LatLngBounds;if(d[0]>180||d[0]<-180||d[1]>90||d[1]<-90||e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)d[0]="-30",d[1]="-50",e[0]="110",e[1]="80";f.extend(new google.maps.LatLng(d[1],d[0])),f.extend(new google.maps.LatLng(e[1],e[0])),b.fitBounds(f)}},error:function(a){}})}function Timeline(){this.features=[],this.featurePositionsInPx={}}Timeline.prototype.initDOM=function(){var a=this;$("#timeline_bar").on("click","a.play",function(b){a.start(),b.preventDefault,b.stopPropagation()}),$("#timeline_bar").on("click","a.pause",function(b){a.pause(),b.preventDefault,b.stopPropagation()}),$(document).keyup(function(b){b.keyCode==32&&(a.playOrPause(),b.preventDefault(),b.stopPropagation())})},Timeline.prototype.setupFeatures=function(a,b,c){this.infowindow=b,this.featureList=c,this.features=a;var d=this,e=a[0].date,f=a[a.length-1].date,g=e-f,h=$("#timeline ul.items"),i=$("#timeline").width(),j,k;a.forEach(function(a){j=$("<li/>"),k=(e-a.date)*100/g,j.css("left",k+"%").attr("data-date",a.date).attr("data-id",a.id).appendTo(h),d.featurePositionsInPx[parseInt(k*i*.01).toString()]=a.id}),j=$("<li/>"),j.attr("id","pointer").css("left","0%").appendTo(h),this.initDOM()},Timeline.prototype.start=function(){$("#timeline_bar a.button").removeClass("play").addClass("pause").html("Pause"),this.state="playing";var a=this;this.timer=setInterval(function(){var b=parseInt($("#pointer").css("left"))+1;$("#pointer").css("left",b+"px"),b>=$("#timeline").width()-$("#pointer").width()&&clearInterval(a.timer),a.triggerClick(b)},300)},Timeline.prototype.pause=function(){$("#timeline_bar a.button").addClass("play").removeClass("pause").html("Play"),this.state="paused;",clearInterval(this.timer)},Timeline.prototype.playOrPause=function(){this.state=="playing"?this.pause():this.start()},Timeline.prototype.setPointer=function(a){$("#pointer").css("left",a+"px"),this.triggerClick(a)},Timeline.prototype.triggerClick=function(a){var b=this.featurePositionsInPx[a.toString()];b!=null&&(this.infowindow.open(b,null,this.featureList),$("#timeline ul.items li").removeClass("selected"),$("#timeline ul.items li[data-id="+b+"]").addClass("selected"))};